# PostgreSQL via docker compose with exec ready probe
postgres ready=exec:"usql postgres://demo:demo@localhost:5432/demo -c 'select 1'": docker compose --progress plain up --quiet-pull postgres

# One-shot: apply schema after postgres is ready
migrate! *.sql after=postgres: usql postgres://demo:demo@localhost:5432/demo -f schema.sql

# Go server with hot reload and HTTP readiness probe
api go.mod *.go after=migrate ready=http:8080/health=200 debounce=500ms: go run .

# Seed some data
seed! after=api:
    # Curl without progress
    curl -s --json '{"name": "Alice", "email": "alice@example.com"}' http://localhost:8080/users
    curl -s --json '{"name": "Bob", "email": "bob@example.com"}' http://localhost:8080/users
    curl -s --json '{"name": "Charlie", "email": "charlie@example.com"}' http://localhost:8080/users
    curl -s http://localhost:8080/users | jq
